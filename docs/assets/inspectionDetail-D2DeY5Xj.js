import{i as O,j as x,m as a,k as H,l as $,h as G,b as k,n as _,c as f,o as K,p as W,q as X}from"./main-BjQPQWDg.js";/* empty css               *//* empty css              */import{a as Y,u as Z}from"./inspectionService-A3-19NT0.js";import{g as ee,a as te}from"./frameService-Fq8ImOPJ.js";import"./db-Cx3PrDYs.js";const r=document.querySelector("main"),I=document.getElementById("back-button"),D=document.getElementById("loading");O("Loading").then(async()=>{try{const e=new URLSearchParams(window.location.search),t=e.get("inspectionId"),o=e.get("sentFrom"),s=e.get("year");if(o&&s?S(o,s):o&&S(o,null),t){const l=parseInt(t),n=await Y(l);document.title=`${x(n.inspection_date)} - BuzzNote`;const i=sessionStorage.getItem("inspectionIds"),c=a("section","inspection-header",null,null),C=a("h2",null,null,`${n.hive_name} | ${x(n.inspection_date)} | ${n.start_time}`);if(c.appendChild(C),i){const u=JSON.parse(i),h=u.findIndex(d=>d.toString()===t);if(h>0){const d=q(u[h-1],o,s),m=H("Previous",d,!1,"button white",null);m.setAttribute("id","previous-button"),c.appendChild(m)}if(h<u.length-1){const d=q(u[h+1],o,s),m=H("Next",d,!1,"button white",null);m.setAttribute("id","next-button"),c.appendChild(m)}}r.appendChild(c);const y=$(n,["weather","bee_population","drone_population","laying_pattern","hive_beetles","other_pests","brood"],"inspection_id");r.appendChild(y);const L=await ee(parseInt(t));if(L){const u=a("h2",null,null,"Box Averages");r.appendChild(u);const h=["box_name","num_frames","honey","nectar","brood","queen_cells","drawn_comb","queen_spotted","expand"];for(const p of L){const B=$(p,h,"average_id");r.appendChild(B);const N=await te(parseInt(t),p.box_name),v=G(N,["frame_number","honey","nectar","brood","queen_cells","drawn_comb"],"frame_id");r.appendChild(v),v.classList.add("hide");const w=B.querySelector("button");w.addEventListener("click",()=>{console.log(`Expand button for ${p.box_name} clicked - ${p.showFrames}`),v.classList.toggle("hide"),p.showFrames===!0?(p.showFrames=!1,w.textContent="expand_all"):(p.showFrames=!0,w.textContent="collapse_all")});const F=a("div",null,"box-container",null);N.forEach(g=>{const V=`frame-container ${oe(g)}`,A=a("div",null,V,null),j=`${g.frame_number} ${p.queen_spotted===g.frame_number?"Queen Spotted ":""} ${g.queen_cells?"Queen Cells":""}`,J=a("p",null,"frame-text",j);A.appendChild(J),F.appendChild(A)}),r.appendChild(F)}const d=a("fieldset","visual-legend",null,null),m=a("legend",null,null,"Legend");d.appendChild(m);const M=b("honey");d.appendChild(M);const U=b("nectar");d.appendChild(U);const z=b("draw-comb");d.appendChild(z);const Q=b("brood");d.appendChild(Q);const R=b("none");d.appendChild(R),r.appendChild(d)}else{const u=a("h2","no-frames",null,"No frames recorded");r.appendChild(u)}P(n),r.classList.remove("hide"),D.classList.add("hide")}else throw new Error("Could not load inspection details. Please return to the previous page and try again")}catch(e){k(e,"main-message","error"),D.classList.add("hide")}});function S(e,t){switch(e){case"search":I.addEventListener("click",()=>_("/search"));break;default:t?I.addEventListener("click",()=>_("/past/",{params:{year:t.toString()}})):I.addEventListener("click",()=>_("/past/"));break}}async function ne(e,t){try{const o=e.get("textAreaInput");if(o===null||o.toString().trim()==="")throw new Error("Please do not leave the notes empty");const l=X(new Date);t.notes=o.toString(),t.last_updated=l;const n=await Z(t);P(n),k("Updated notes successfully.","main-message","check_circle")}catch(o){k(o,"edit-message","error")}K("notes-backdrop")}function P(e){let t=!1;const o=document.getElementById("edit-notes-form");o&&o.remove();const s=document.getElementById("notes-display");s&&s.remove();const l=a("div","notes-display",null,null);if(!e.notes||e.notes.toString().trim()===""){const n=a("h2",null,null,"No Notes");l.appendChild(n)}else{t=!0;const n=a("h2",null,null,"Notes");l.appendChild(n);const i=document.createElement("p");i.innerHTML=e.notes.replace(/\n/g,"<br/>"),l.appendChild(i)}if(e.last_updated){const n=document.createElement("p"),i=a("b",null,null,"Last Updated: ");n.appendChild(i);const c=a("span",null,null,x(e.last_updated.toString()));n.appendChild(c),l.appendChild(n)}if(t){const n=f("Edit Notes","button","edit-button","button white","edit");n.addEventListener("click",()=>T(e,t)),l.appendChild(n)}else{const n=f("Add Notes","button","edit-button","button white","add");n.addEventListener("click",()=>T(e,t)),l.appendChild(n)}r.appendChild(l)}function T(e,t){const o=document.getElementById("notes-backdrop"),s=document.getElementById("notes-modal");s.innerHTML="";let l=a("h2",null,null,null);t?l.textContent="Edit Notes:":l.textContent="Add Notes:",s.appendChild(l);const n=document.createElement("textarea");n.id="textAreaInput",n.name="textAreaInput",n.value=e.notes,s.appendChild(n);const i=a("section",null,"button-group-row",null),c=f("Close","button","close-button","button red");c.addEventListener("click",()=>K("notes-backdrop")),i.appendChild(c);const C=f("Submit","submit","submit-button","button green");i.appendChild(C),s.appendChild(i),s.addEventListener("submit",async E=>{E.preventDefault();const y=new FormData(s);await ne(y,e)}),W(o,s,"textAreaInput")}function oe(e){return e.brood?"brood":e.honey||e.nectar?"honey":e.drawn_comb?"draw-comb":"none"}function b(e){const t=a("label",null,null,null),o=a("span",null,e,null);t.appendChild(o);const s=a("p",null,null,e);return t.appendChild(s),t}function q(e,t,o){return t&&o?`inspectionDetail?sentFrom=${t}&year=${o}&inspectionId=${e}`:t?`inspectionDetail?sentFrom=${t}&inspectionId=${e}`:`inspectionDetail?inspectionId=${e}`}
