import{i as S,d as I,F,a as _,e as q,A as E,f as m,m as C,h}from"./main-CFFFykfE.js";/* empty css              */import{g as L}from"./boxService-Cl_vR1cZ.js";import"./db-BoHkaBle.js";let p=null,x=[];const $=document.querySelector("main"),B=document.getElementById("box-selection"),w=document.getElementById("frames"),k=document.getElementById("loading"),y=document.getElementById("finish-section"),M=document.getElementById("finish-button");S("Frames").then(async()=>{try{const s=sessionStorage.getItem("hiveId");if(s){const i=JSON.parse(s);p=await L(i,!0),p.forEach(e=>{let o=0;e.box_id&&(o=e.box_id);const n=N(e.num_frames,o),c={boxInfo:e,frames:n,recorded:!1};x.push(c)}),T(),M.addEventListener("click",()=>{J()})}else throw new Error("No hive ID found, please go back home and try again.")}catch(s){I(s,"main-message","error")}k.classList.add("hide"),$.classList.remove("hide")});function N(s,i){let e=[];for(let o=0;o<s;o++){const n=new m(!1,!1),c=new F(i,o+1,n,n,n,n,n,n,!1);e.push(c)}return e}function T(){if(p){B.innerHTML="";const s=p.reduce((i,e,o)=>{let n=0;e.box_id&&(n=e.box_id);const c=_(e.box_name,"button",n.toString(),"button white large full");return c.addEventListener("click",()=>{B.classList.add("hide"),y.classList.add("hide");const a=x.find(u=>u.boxInfo.box_id===n);a&&H(a,o)}),i.appendChild(c),i},document.createElement("selection"));s.setAttribute("class","button-group-column"),B.appendChild(s),B.classList.remove("hide")}}function H(s,i){w.classList.remove("hide");let e=0;const o=s.frames,n=o.length,c=()=>{w.innerHTML="";const u=o[e],r=P(s.boxInfo.box_name,u,e,n);w.appendChild(r);const l=r.querySelector("#previous-button"),b=r.querySelector("#next-button"),t=r.querySelector("#next-box-button");l&&l.addEventListener("click",d=>{d.preventDefault(),a(r),e--,c()}),b&&b.addEventListener("click",d=>{d.preventDefault(),a(r),e++,c()}),t&&t.addEventListener("click",()=>{a(r);const d=document.getElementById(u.box_id.toString());d&&(s.frames=o,s.recorded=!0,x[i]=s,d.classList.remove("white"),d.classList.add("green"),w.classList.add("hide"),B.classList.remove("hide"),y.classList.remove("hide"))})},a=u=>{const r=new FormData(u),l=o[e];o[e]=z(l.box_id,l.frame_number,r)};c()}function P(s,i,e,o){const n=C("form","frame-form",null,null),c=C("h2",null,null,`Box: ${s} | Frame: ${i.frame_number}`);n.appendChild(c);const a=h("Honey",i.honey);n.appendChild(a);const u=h("Nectar",i.nectar);n.appendChild(u);const r=h("Brood",i.brood);n.appendChild(r);const l=h("Queen Cells",i.queen_cells);n.appendChild(l);const b=h("Drawn Comb",i.drawn_comb);n.appendChild(b);const t=h("Queen Spotted",i.queen_spotted);n.appendChild(t),w.appendChild(n);const d=C("section","form-actions","button-group-row",null);if(e>0){const f=_("Previous Frame","button","previous-button","button blue");d.appendChild(f)}if(e<o-1){const f=_("Next Frame","button","next-button","button blue");d.appendChild(f)}const g=_("Next Box","button","next-box-button","button orange");return d.appendChild(g),n.appendChild(d),n}function z(s,i,e){let o=new m(!1,!1);e.get("honey-a")&&(o.sideA=!0),e.get("honey-b")&&(o.sideB=!0);let a=new m(!1,!1);e.get("nectar-a")&&(a.sideA=!0),e.get("nectar-b")&&(a.sideB=!0);let l=new m(!1,!1);e.get("brood-a")&&(l.sideA=!0),e.get("brood-b")&&(l.sideB=!0);let d=new m(!1,!1);e.get("queen_spotted-a")&&(d.sideA=!0),e.get("queen_spotted-b")&&(d.sideB=!0);let A=new m(!1,!1);e.get("queen_cells-a")&&(A.sideA=!0),e.get("queen_cells-b")&&(A.sideB=!0);let v=new m(!1,!1);return e.get("drawn_comb-a")&&(v.sideA=!0),e.get("drawn_comb-b")&&(v.sideB=!0),{box_id:s,frame_number:i,honey:o,nectar:a,brood:l,queen_cells:A,queen_spotted:d,drawn_comb:v,recorded:!0}}function J(){let s=[],i=[];x.forEach(e=>{if(e.recorded){const o=e.frames.filter(t=>t.recorded===!0);let n=0,c=0,a=0,u=0,r=0,l="Not Spotted";o.forEach(t=>{let d=0;if(e.boxInfo.box_id&&(d=e.boxInfo.box_id),t.recorded){t.honey.sideA&&(n+=1),t.honey.sideB&&(n+=1),t.nectar.sideA&&(c+=1),t.nectar.sideB&&(c+=1),t.brood.sideA&&(a+=1),t.brood.sideB&&(a+=1),t.drawn_comb.sideA&&(u+=1),t.drawn_comb.sideB&&(u+=1),t.queen_cells.sideA&&(r+=1),t.queen_cells.sideB&&(r+=1),t.queen_spotted.sideA&&(l=`${t.frame_number}A`),t.queen_spotted.sideB&&(l=`${t.frame_number}B`);const g=new q(d,0,e.boxInfo.box_name,`${t.frame_number}A`,t.drawn_comb.sideA,t.honey.sideA,t.nectar.sideA,t.brood.sideA,t.queen_spotted.sideA);s.push(g);const f=new q(d,0,e.boxInfo.box_name,`${t.frame_number}B`,t.drawn_comb.sideB,t.honey.sideB,t.nectar.sideB,t.brood.sideB,t.queen_spotted.sideB);s.push(f)}});const b=o.length;if(b>0){let t=new E(0,e.boxInfo.box_name,o.length,`${Math.trunc(n/b*100)}%`,`${Math.trunc(c/b*100)}%`,`${Math.trunc(a/b*100)}%`,`${Math.trunc(r/b*100)}%`,`${Math.trunc(u/b*100)}%`,l);i.push(t)}}}),sessionStorage.setItem("frames",JSON.stringify(s)),sessionStorage.setItem("averages",JSON.stringify(i)),window.location.href="buzz-note-v3/end"}
