import{i as F,m as l,a as f,j as M,d as h,r as k,u as S,n as g,o as L,v as P,w as R}from"./main-Ca-RDbF7.js";/* empty css               *//* empty css              */import{g as $,a as D,b as z,u as O}from"./boxService-C4LAXU5Z.js";import{b as H,u as T}from"./hiveService-C0nXD36h.js";import"./db-1doVCpW2.js";const j=document.getElementById("loading"),w=document.querySelector("main");async function I(a,n,t){try{const e={box_id:t||0,hive_id:n,box_name:"",box_type:"",num_frames:0,active:!1,overwinter:!1},o=a.get("box-name-input");if(o===null||o.toString().trim()===""){h("Please enter a name for the box","manage-hive-message","error");return}else e.box_name=o.toString();const i=a.get("num-frames-input");if(i===null||i.toString().trim()===""){h("Please enter the number of frames","manage-hive-message","error");return}else if(parseInt(i.toString())<1){h("# of frames should be greater than 0","manage-hive-message","error");return}else e.num_frames=parseInt(i.toString());const d=a.get("box-type-input");if(d===null||d.toString().trim()===""){h("Please enter the box type","manage-hive-message","error");return}else e.box_type=d.toString();const c=a.get("status-checkbox")!==null;c&&(e.active=c);const s=a.get("overwintered-checkbox")!==null;s&&(e.overwinter=s);const u=["box_name","num_frames","overwinter","active","box_type","edit"];if(t)await O(t,e),g("manage-hive-backdrop"),R("Box updated successfully","main-message","check_circle"),window.location.reload();else{const m=await z(e);let r=0;m.box_id&&(r=parseInt(m.box_id)),e.box_id=r,g("manage-hive-backdrop");const p=P(e,u,e.box_id.toString()),v=document.getElementById("boxes-table"),x=await H(n);x.num_boxes+=1,await T(x),v?(v.querySelector("tbody").appendChild(p),h(m.message,"main-message","check_circle"),p.querySelector("button").addEventListener("click",()=>E(n,r))):window.location.reload()}g("manage-hive-backdrop")}catch(e){h(e,"main-message","error"),g("manage-hive-backdrop")}}async function U(a,n){try{let t={hive_id:n.hive_id,hive_name:n.hive_name,num_boxes:n.num_boxes,active:n.active};const e=a.get("hive-name-input");if(e===null||e.toString().trim()===""){h("Please enter a name for the new hive","add-hive-message","error");return}else t.hive_name=e.toString();a.get("status-checkbox")!==null?t.active=1:t.active=0,await T(t),h("Hive updated successfully","main-message","check_circle");const i=document.getElementById("page-heading");i.textContent=`${t.hive_name} (${t.active?"Active":"Not Active"})`}catch(t){h(t,"main-message","error")}g("manage-hive-backdrop")}async function E(a,n){const t=document.getElementById("manage-hive-backdrop"),e=document.getElementById("manage-box-modal");e.innerHTML="";let o=null;if(n!==null){o=await D(n);const b=l("h2",null,null,`Edit the details for ${o.box_name}`);e.appendChild(b)}else{const b=l("h2",null,null,"Enter the details for the new box");e.appendChild(b)}const i=k("text","box-name-input","Box Name:","form-row");e.appendChild(i);const d=k("number","num-frames-input","# of Frames","form-row");e.appendChild(d);const c=k("text","box-type-input","Box Type:","form-row");e.appendChild(c);const s=l("section",null,"form-row",null),u=l("p",null,null,"status:");s.appendChild(u);const m=S("Active","Not Active","status-checkbox",!1,!1);s.appendChild(m);const r=S("Overwintered","Not Overwintered","overwintered-checkbox",!1,!1);if(s.appendChild(r),e.appendChild(s),o){const b=i.querySelector("input");b.value=o.box_name;const _=d.querySelector("input");_.value=o.num_frames.toString();const q=c.querySelector("input");q.value=o.box_type;const A=m.querySelector("input"),C=m.querySelector("label");A.checked=o.active,o.active&&(C.textContent="Active",C.classList.remove("red"),C.classList.add("green"));const N=r.querySelector("input"),B=r.querySelector("label");N.checked=o.overwinter,o.overwinter&&(B.textContent="Overwintered",B.classList.remove("red"),B.classList.add("green"))}const p=l("section",null,"button-group-row",null),v=f("Close","button","close-button","button red");v.addEventListener("click",()=>g("manage-hive-backdrop")),p.appendChild(v);const x=f("Submit","submit","submit-button","button green");p.appendChild(x),e.appendChild(p);let y=null;return e.addEventListener("submit",async b=>{b.preventDefault();const _=new FormData(e);o?await I(_,a,n):await I(_,a,null)}),L(t,e,"box-name-input"),y}async function G(a){const n=await H(a),t=document.getElementById("manage-hive-backdrop"),e=document.getElementById("manage-box-modal");e.innerHTML="";const o=l("h2",null,null,"Edit hive details");e.appendChild(o);const i=k("text","hive-name-input","Hive Name:","form-row"),d=i.querySelector("input");d.value=n.hive_name,e.appendChild(i);const c=l("section",null,"form-row",null),s=l("p",null,null,"status:");c.appendChild(s);const u=S("Active","Not Active","status-checkbox",!1,!!n.active),m=u.querySelector("input"),r=u.querySelector("label");n.active&&(r.textContent="Active",r.classList.remove("red"),r.classList.add("green"),m.checked=!0),c.appendChild(u),e.appendChild(c);const p=l("section",null,"button-group-row",null),v=f("Close","button","close-button","button red");v.addEventListener("click",()=>g("manage-hive-backdrop")),p.appendChild(v);const x=f("Submit","submit","submit-button","button green");p.appendChild(x),e.appendChild(p),e.addEventListener("submit",y=>{y.preventDefault();const b=new FormData(e);U(b,n)}),L(t,e,"box-name-input")}F("Loading").then(async()=>{try{const n=new URLSearchParams(window.location.search).get("hiveId");if(n){const t=await H(parseInt(n));document.title=`Manage ${t.hive_name} - Buzznote`;const e=l("section",null,"button-group-row",null),o=l("H2","page-heading",null,`${t.hive_name} (${t.active?"Active":"Not Active"})`);e.appendChild(o);const i=f("Edit Hive","button","edit-hive","button orange","edit");if(t.hive_id){const s=t.hive_id;i.addEventListener("click",()=>G(s))}e.appendChild(i),w.appendChild(e);const d=await $(parseInt(n),!1);if(d.length>0){const u=M(d,["box_name","num_frames","overwinter","active","box_type","edit"],"box_id");u.setAttribute("id","boxes-table"),u.querySelectorAll("tr").forEach(r=>{r.addEventListener("click",async()=>{await E(parseInt(n),parseInt(r.id))})}),w.appendChild(u)}else{const s=l("h2",null,null,`No boxes for ${t.hive_name}`);w.appendChild(s)}const c=f("Add Box","button","add-box","button blue","add");c.addEventListener("click",()=>E(parseInt(n),null)),w.appendChild(c)}else throw new Error("Hive data not loaded. Please return to the previous page and try again.")}catch(a){h(a,"main-message","error")}j.classList.add("hide"),w.classList.remove("hide")});
