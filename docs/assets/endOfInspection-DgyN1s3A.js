import{i as y,n as f,y as C,b as S,m as d,z as E,v as _,c as I,r as L,l as P,h as N,x as B}from"./main-BCth8lYq.js";/* empty css              *//* empty css               */import{b as A,c as F}from"./frameService-vKdwFKVc.js";import{c as T}from"./inspectionService-CxI-5-Cf.js";import"./db-BVU1Rzfc.js";const w=document.getElementById("loading"),e=document.querySelector("main"),H=document.getElementById("back-button");y("End of Inspection").then(()=>{try{H.addEventListener("click",()=>f("/"));const o=sessionStorage.getItem("date"),t=sessionStorage.getItem("time"),s=sessionStorage.getItem("hiveId"),n=sessionStorage.getItem("hiveName"),r=sessionStorage.getItem("weather"),p=sessionStorage.getItem("averages"),a=sessionStorage.getItem("frames");if(o&&t&&s&&n&&r&&p&&a){const i=JSON.parse(s),m=JSON.parse(r),l=JSON.parse(p),c=new C(i,o,n,t,m.temp,m.condition,"","","","","","",!1,!1,!1,!1,"","");l.forEach(g=>{g.queen_spotted!=="Not Spotted"&&(c.queen_spotted=!0)}),k(c),w.classList.add("hide"),e.classList.remove("hide")}else throw e.classList.add("hide"),new Error("Inspection data is missing. Please start the inspection over")}catch(o){S(o,"main-message","error")}});function O(o,t){L();let s=t;const n=["bee-temperament","bee-population","drone-population","laying-pattern","hive-beetles","other-pests"];let r=[];if(n.forEach(l=>{const c=o.get(l),g=l.split("-").map(u=>u.length===0?"":u.charAt(0).toUpperCase()+u.slice(1).toLowerCase()).join(" ");c===null?r.push(g):t[l.replace("-","_")]=c}),o.get("brood-eggs")&&(s.brood_eggs=!0),o.get("brood-larva")&&(s.brood_larva=!0),o.get("brood-capped")&&(s.brood_capped=!0),r.length>0){const l="The following values need to be set: "+r.join(", ");S(l,"main-message","error");return}V(s);const m=document.getElementById("end-form");m&&m.remove()}function k(o){const t=d("form","end-form",null,null);[{label:"Bee Temperament",options:["Calm","Nervous","Angry","Crazy"],colors:["green","yellow","orange","red"]},{label:"Bee Population",options:["Low","Normal","Crowded"],colors:["yellow","green","yellow"]},{label:"Drone Population",options:["Low","Normal","Crowded"],colors:["yellow","green","yellow"]},{label:"Laying Pattern",options:["Good","Spotty"],colors:["green","yellow"]},{label:"Hive Beetles",options:["None","Few","Lots"],colors:["green","yellow","red"]},{label:"Other Pests",options:["None","Few","Lots"],colors:["green","yellow","red"]}].forEach(a=>{t.appendChild(E(a.label,a.options,a.colors))});const n=d("div",null,"button-group-row",null);["Eggs","Larva","Capped"].forEach(a=>{const i=_(`Brood ${a}`,`Brood ${a}`,`brood-${a.toLowerCase()}`,!1,!0);n.appendChild(i)}),t.appendChild(n);const p=I("Submit","submit","submit-button","button green");t.appendChild(p),t.addEventListener("submit",a=>{a.preventDefault();const i=new FormData(t);O(i,o)}),e.appendChild(t)}function V(o){const t=sessionStorage.getItem("averages"),s=sessionStorage.getItem("frames");if(t&&s){const n=JSON.parse(t),r=JSON.parse(s),p=d("H2",null,null,"Data Review");e.appendChild(p);const i=P(o,["weather","bee_population","drone_population","laying_pattern","hive_beetles","other_pests","brood"],"inspection_id");e.appendChild(i);const l=N(n,["box_name","num_frames","honey","nectar","brood","queen_cells","drawn_comb","queen_spotted"],"average_id");e.appendChild(l);const c=I("Send data to database","button","send-data","button green");c.addEventListener("click",async()=>await D(r,n,o)),e.appendChild(c)}}async function D(o,t,s){try{w.classList.remove("hide"),e.innerHTML="";const n=d("h2",null,null,"Sending data to database. Please do not leave this page.");e.appendChild(n);const r=await T(s),p=d("p",null,null,r.message);e.prepend(p);const a=d("p",null,null,"Starting to send frames");e.prepend(a);const i=r.inspection_id;let m=0;o.forEach(async b=>{const v=document.getElementById("frame-num-added");b.inspection_id=parseInt(i),await A(b),m+=1;const h=d("p","frame-num-added",null,`Submitted frames: ${m}`);v?e.replaceChild(h,v):e.prepend(h)});const l=d("p",null,null,"All frames submitted");e.prepend(l);const c=d("p",null,null,"Submitting averages");e.prepend(c);let g=0;t.forEach(async b=>{const v=document.getElementById("average-num-added");b.inspection_id=parseInt(i),await F(b),g+=1;const h=d("p","average-num-added",null,`Added average #${g}`);v?e.replaceChild(h,v):e.prepend(h)});const u=d("p",null,null,"All data submitted to database");e.prepend(u),sessionStorage.removeItem("date"),sessionStorage.removeItem("time"),sessionStorage.removeItem("hiveId"),sessionStorage.removeItem("hiveName"),sessionStorage.removeItem("weather"),sessionStorage.removeItem("averages"),sessionStorage.removeItem("frames"),B("All data submitted to database","main-message","check_circle"),setTimeout(()=>{f("/",{replace:!0})},2e3)}catch(n){throw n}}
