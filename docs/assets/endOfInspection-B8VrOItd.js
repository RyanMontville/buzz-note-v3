import{i as I,x as y,d as f,m as d,y as C,u as _,a as w,q as E,l as L,j as P,w as N}from"./main-Ca-RDbF7.js";/* empty css              *//* empty css               */import{b as A,c as B}from"./frameService-DgibUwlt.js";import{c as F}from"./inspectionService-BZO5sn4U.js";import"./db-1doVCpW2.js";const S=document.getElementById("loading"),e=document.querySelector("main");I("End of Inspection").then(()=>{try{const o=sessionStorage.getItem("date"),t=sessionStorage.getItem("time"),n=sessionStorage.getItem("hiveId"),s=sessionStorage.getItem("hiveName"),r=sessionStorage.getItem("weather"),p=sessionStorage.getItem("averages"),a=sessionStorage.getItem("frames");if(o&&t&&n&&s&&r&&p&&a){const i=JSON.parse(n),m=JSON.parse(r),l=JSON.parse(p),c=new y(i,o,s,t,m.temp,m.condition,"","","","","","",!1,!1,!1,!1,"","");l.forEach(g=>{g.queen_spotted!=="Not Spotted"&&(c.queen_spotted=!0)}),H(c),S.classList.add("hide"),e.classList.remove("hide")}else throw e.classList.add("hide"),new Error("Inspection data is missing. Please start the inspection over")}catch(o){f(o,"main-message","error")}});function T(o,t){E();let n=t;const s=["bee-temperament","bee-population","drone-population","laying-pattern","hive-beetles","other-pests"];let r=[];if(s.forEach(l=>{const c=o.get(l),g=l.split("-").map(u=>u.length===0?"":u.charAt(0).toUpperCase()+u.slice(1).toLowerCase()).join(" ");c===null?r.push(g):t[l.replace("-","_")]=c}),o.get("brood-eggs")&&(n.brood_eggs=!0),o.get("brood-larva")&&(n.brood_larva=!0),o.get("brood-capped")&&(n.brood_capped=!0),r.length>0){const l="The following values need to be set: "+r.join(", ");f(l,"main-message","error");return}O(n);const m=document.getElementById("end-form");m&&m.remove()}function H(o){const t=d("form","end-form",null,null);[{label:"Bee Temperament",options:["Calm","Nervous","Angry","Crazy"],colors:["green","yellow","orange","red"]},{label:"Bee Population",options:["Low","Normal","Crowded"],colors:["yellow","green","yellow"]},{label:"Drone Population",options:["Low","Normal","Crowded"],colors:["yellow","green","yellow"]},{label:"Laying Pattern",options:["Good","Spotty"],colors:["green","yellow"]},{label:"Hive Beetles",options:["None","Few","Lots"],colors:["green","yellow","red"]},{label:"Other Pests",options:["None","Few","Lots"],colors:["green","yellow","red"]}].forEach(a=>{t.appendChild(C(a.label,a.options,a.colors))});const s=d("div",null,"button-group-row",null);["Eggs","Larva","Capped"].forEach(a=>{const i=_(`Brood ${a}`,`Brood ${a}`,`brood-${a.toLowerCase()}`,!1,!0);s.appendChild(i)}),t.appendChild(s);const p=w("Submit","submit","submit-button","button green");t.appendChild(p),t.addEventListener("submit",a=>{a.preventDefault();const i=new FormData(t);T(i,o)}),e.appendChild(t)}function O(o){const t=sessionStorage.getItem("averages"),n=sessionStorage.getItem("frames");if(t&&n){const s=JSON.parse(t),r=JSON.parse(n),p=d("H2",null,null,"Data Review");e.appendChild(p);const i=L(o,["weather","bee_population","drone_population","laying_pattern","hive_beetles","other_pests","brood"],"inspection_id");e.appendChild(i);const l=P(s,["box_name","num_frames","honey","nectar","brood","queen_cells","drawn_comb","queen_spotted"],"average_id");e.appendChild(l);const c=w("Send data to database","button","send-data","button green");c.addEventListener("click",async()=>await V(r,s,o)),e.appendChild(c)}}async function V(o,t,n){try{S.classList.remove("hide"),e.innerHTML="";const s=d("h2",null,null,"Sending data to database. Please do not leave this page.");e.appendChild(s);const r=await F(n),p=d("p",null,null,r.message);e.prepend(p);const a=d("p",null,null,"Starting to send frames");e.prepend(a);const i=r.inspection_id;let m=0;o.forEach(async b=>{const h=document.getElementById("frame-num-added");b.inspection_id=parseInt(i),await A(b),m+=1;const v=d("p","frame-num-added",null,`Submitted frames: ${m}`);h?e.replaceChild(v,h):e.prepend(v)});const l=d("p",null,null,"All frames submitted");e.prepend(l);const c=d("p",null,null,"Submitting averages");e.prepend(c);let g=0;t.forEach(async b=>{const h=document.getElementById("average-num-added");b.inspection_id=parseInt(i),await B(b),g+=1;const v=d("p","average-num-added",null,`Added average #${g}`);h?e.replaceChild(v,h):e.prepend(v)});const u=d("p",null,null,"All data submitted to database");e.prepend(u),sessionStorage.removeItem("date"),sessionStorage.removeItem("time"),sessionStorage.removeItem("hiveId"),sessionStorage.removeItem("hiveName"),sessionStorage.removeItem("weather"),sessionStorage.removeItem("averages"),sessionStorage.removeItem("frames"),N("All data submitted to database","main-message","check_circle"),setTimeout(()=>{window.location.href="/"},2e3)}catch(s){throw s}}
