import{i as J,k as I,m as a,c as F,l as $,j as O,d as x,a as g,n as K,o as G,p as W}from"./main-CFFFykfE.js";/* empty css               *//* empty css              */import{a as X,u as Y}from"./inspectionService-lFEoiRx_.js";import{g as Z,a as ee}from"./frameService-g_kE-n-1.js";import"./db-BoHkaBle.js";const r=document.querySelector("main"),_=document.getElementById("back-button"),H=document.getElementById("loading");function D(e,t){switch(e){case"search":_.setAttribute("href","/search");break;default:t?_.setAttribute("href",`/past/?year=${t}`):_.setAttribute("href","/past/");break}}async function te(e,t){try{const o=e.get("textAreaInput");if(o===null||o.toString().trim()==="")throw new Error("Please do not leave the notes empty");const l=W(new Date);t.notes=o.toString(),t.last_updated=l;const n=await Y(t);P(n),x("Updated notes successfully.","main-message","check_circle")}catch(o){x(o,"edit-message","error")}K("notes-backdrop")}function P(e){let t=!1;const o=document.getElementById("edit-notes-form");o&&o.remove();const s=document.getElementById("notes-display");s&&s.remove();const l=a("div","notes-display",null,null);if(!e.notes||e.notes.toString().trim()===""){const n=a("h2",null,null,"No Notes");l.appendChild(n)}else{t=!0;const n=a("h2",null,null,"Notes");l.appendChild(n);const i=document.createElement("p");i.innerHTML=e.notes.replace(/\n/g,"<br/>"),l.appendChild(i)}if(e.last_updated){const n=document.createElement("p"),i=a("b",null,null,"Last Updated: ");n.appendChild(i);const c=a("span",null,null,I(e.last_updated.toString()));n.appendChild(c),l.appendChild(n)}if(t){const n=g("Edit Notes","button","edit-button","button white","edit");n.addEventListener("click",()=>S(e,t)),l.appendChild(n)}else{const n=g("Add Notes","button","edit-button","button white","add");n.addEventListener("click",()=>S(e,t)),l.appendChild(n)}r.appendChild(l)}function S(e,t){const o=document.getElementById("notes-backdrop"),s=document.getElementById("notes-modal");s.innerHTML="";let l=a("h2",null,null,null);t?l.textContent="Edit Notes:":l.textContent="Add Notes:",s.appendChild(l);const n=document.createElement("textarea");n.id="textAreaInput",n.name="textAreaInput",n.value=e.notes,s.appendChild(n);const i=a("section",null,"button-group-row",null),c=g("Close","button","close-button","button red");c.addEventListener("click",()=>K("notes-backdrop")),i.appendChild(c);const C=g("Submit","submit","submit-button","button green");i.appendChild(C),s.appendChild(i),s.addEventListener("submit",async k=>{k.preventDefault();const y=new FormData(s);await te(y,e)}),G(o,s,"textAreaInput")}function ne(e){return e.brood?"brood":e.honey||e.nectar?"honey":e.drawn_comb?"draw-comb":"none"}function b(e){const t=a("label",null,null,null),o=a("span",null,e,null);t.appendChild(o);const s=a("p",null,null,e);return t.appendChild(s),t}function T(e,t,o){return t&&o?`inspectionDetail?sentFrom=${t}&year=${o}&inspectionId=${e}`:t?`inspectionDetail?sentFrom=${t}&inspectionId=${e}`:`inspectionDetail?inspectionId=${e}`}J("Loading").then(async()=>{try{const e=new URLSearchParams(window.location.search),t=e.get("inspectionId"),o=e.get("sentFrom"),s=e.get("year");if(o&&s?D(o,s):o&&D(o,null),t){const l=parseInt(t),n=await X(l);document.title=`${I(n.inspection_date)} - Buzznote`;const i=sessionStorage.getItem("inspectionIds"),c=a("section","inspection-header",null,null),C=a("h2",null,null,`${n.hive_name} | ${I(n.inspection_date)} | ${n.start_time}`);if(c.appendChild(C),i){const u=JSON.parse(i),h=u.findIndex(d=>d.toString()===t);if(h>0){const d=T(u[h-1],o,s),m=F("Previous",d,!1,"button white",null);m.setAttribute("id","previous-button"),c.appendChild(m)}if(h<u.length-1){const d=T(u[h+1],o,s),m=F("Next",d,!1,"button white",null);m.setAttribute("id","next-button"),c.appendChild(m)}}r.appendChild(c);const y=$(n,["weather","bee_population","drone_population","laying_pattern","hive_beetles","other_pests","brood"],"inspection_id");r.appendChild(y);const E=await Z(parseInt(t));if(E){const u=a("h2",null,null,"Box Averages");r.appendChild(u);const h=["box_name","num_frames","honey","nectar","brood","queen_cells","drawn_comb","queen_spotted","expand"];for(const p of E){const L=$(p,h,"average_id");r.appendChild(L);const B=await ee(parseInt(t),p.box_name),w=O(B,["frame_number","honey","nectar","brood","queen_cells","drawn_comb"],"frame_id");r.appendChild(w),w.classList.add("hide");const v=L.querySelector("button");v.addEventListener("click",()=>{console.log(`Expand button for ${p.box_name} clicked - ${p.showFrames}`),w.classList.toggle("hide"),p.showFrames===!0?(p.showFrames=!1,v.textContent="expand_all"):(p.showFrames=!0,v.textContent="collapse_all")});const A=a("div",null,"box-container",null);B.forEach(f=>{const R=`frame-container ${ne(f)}`,N=a("div",null,R,null),V=`${f.frame_number} ${p.queen_spotted===f.frame_number?"Queen Spotted ":""} ${f.queen_cells?"Queen Cells":""}`,j=a("p",null,"frame-text",V);N.appendChild(j),A.appendChild(N)}),r.appendChild(A)}const d=a("fieldset","visual-legend",null,null),m=a("legend",null,null,"Legend");d.appendChild(m);const q=b("honey");d.appendChild(q);const M=b("nectar");d.appendChild(M);const U=b("draw-comb");d.appendChild(U);const z=b("brood");d.appendChild(z);const Q=b("none");d.appendChild(Q),r.appendChild(d)}else{const u=a("h2","no-frames",null,"No frames recorded");r.appendChild(u)}P(n),r.classList.remove("hide"),H.classList.add("hide")}else throw new Error("Could not load inspection details. Please return to the previous page and try again")}catch(e){x(e,"main-message","error"),H.classList.add("hide")}});
