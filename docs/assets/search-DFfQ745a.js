import{I as L,i as B,n as I,m as c,c as h,r as S,s as w,b as u,t as C,h as q}from"./main-BjQPQWDg.js";/* empty css               *//* empty css              */import{g as R}from"./hiveService-CRJ0-4lg.js";import{d as b}from"./db-Cx3PrDYs.js";import{W as T}from"./weatherService-Bz6kAiig.js";async function y(e,s){let n=[];switch(e){case"hive_id":case"weather_condition":n=await b.inspections.where(e).equals(s).toArray();break;case"queen_spotted":n=await b.inspections.where("queen_spotted").equals(s).toArray();break}return await Promise.all(n.map(async i=>{const a=await b.averages.where("inspection_id").equals(i.inspection_id).toArray(),o=a.length,r=a.reduce((p,l)=>p+(l.num_frames||0),0);return new L(i.inspection_id,i.hive_name,i.inspection_date,i.start_time,o,r,i.notes.length>0)}))}async function E(e,s,n){let t=[];switch(e){case"weather_temp":t=await b.inspections.where(e).between(s,n).toArray();break;case"inspection_date":t=await b.inspections.where("inspection_date").between(s,n,!0,!0).reverse().toArray();break}return await Promise.all(t.map(async a=>{const o=await b.averages.where("inspection_id").equals(a.inspection_id).toArray(),r=o.length,p=o.reduce((l,d)=>l+(d.num_frames||0),0);return new L(a.inspection_id,a.hive_name,a.inspection_date,a.start_time,r,p,a.notes.length>0)}))}async function D(e){return await y("hive_id",e)}async function k(e,s){return E("inspection_date",e,s)}async function A(e,s){return await E("weather_temp",e,s)}async function $(e){return await y("weather_condition",e)}async function _(e){return y("queen_spotted",e)}const x=document.getElementById("loading"),m=document.querySelector("main"),F=document.getElementById("back-button");B("Search").then(()=>{F.addEventListener("click",()=>I("/"));const e=c("h2",null,null,"Choose a search option");m.appendChild(e);const s=c("section","search-option-buttons","search-button-group",null),n=h("Hive","button","hive-button","button white");n.addEventListener("click",async()=>{f(),n.classList.remove("white"),n.classList.add("blue"),await H()}),s.appendChild(n);const t=h("Date Range","button","date-range-button","button white");t.addEventListener("click",async()=>{f(),t.classList.remove("white"),t.classList.add("blue"),await W()}),s.appendChild(t);const i=h("Temperature Range","button","temp-range-button","button white");i.addEventListener("click",async()=>{f(),i.classList.remove("white"),i.classList.add("blue"),await Q()}),s.appendChild(i);const a=h("Weather Condition","button","weather-condition-button","button white");a.addEventListener("click",async()=>{f(),a.classList.remove("white"),a.classList.add("blue"),await P()}),s.appendChild(a);const o=h("Queen Spotted","button","queen-spotted-button","button white");o.addEventListener("click",async()=>{f(),o.classList.remove("white"),o.classList.add("blue"),await G()}),s.appendChild(o),m.appendChild(s),x.classList.add("hide"),m.classList.remove("hide")});function f(){S(),["inspection-table","hive-selection","set-date-range-form","set-temp-range-form","condition-selection","queen-button-row"].forEach(n=>{const t=document.getElementById(n);t&&t.remove()});const s=document.getElementById("search-option-buttons");s&&s.querySelectorAll("button").forEach(t=>{t.classList.contains("blue")&&t.classList.remove("blue"),t.classList.contains("white")||t.classList.add("white")})}async function v(e){S();const s=c("h3","loading-text",null,"Loading inspections...");m.appendChild(s);const t=q(e,["hive_name","inspection_date","start_time","num_boxes","total_frames","has_notes"],"inspection_id");t.classList.add("table-clickable"),t.setAttribute("id","inspection-table"),t.querySelectorAll("tr").forEach(a=>a.addEventListener("click",()=>I("/past/inspectionDetail",{params:{sentFrom:"search",inspectionId:a.id}}))),s.remove(),m.appendChild(t)}async function H(){try{const e=c("section","hive-selection",null,null),s=c("h3","loading-text",null,"Loading Hives...");e.appendChild(s),m.appendChild(e);const n=c("h3",null,"hide","Choose a hive:");e.appendChild(n);const i=(await R(!1)).reduce((a,o)=>{let r=0;o.hive_id&&(r=o.hive_id);const p=`${o.hive_name} ${o.active?"(active)":"(not active)"}`,l=h(p,"button",r.toString(),"button white");return l.addEventListener("click",async()=>{const d=await D(r);e.remove(),d.length>0&&(w(d),await v(d)),u(`${d.length} inspections for ${o.hive_name}`,"main-message","info")}),a.appendChild(l),a},document.createElement("section"));i.setAttribute("class","search-button-group"),s.remove(),n.classList.remove("hide"),e.appendChild(i)}catch(e){u(e,"main-message","error")}}async function W(){try{const e=c("form","set-date-range-form",null,null),s=c("h3",null,null,"Search dates between");e.appendChild(s);const n=c("section",null,"search-button-group",null),t=C("date","start-date-input",null,null);n.appendChild(t);const i=c("p",null,null,"and");n.appendChild(i);const a=C("date","end-date-input",null,null);n.appendChild(a);const o=h("Search","submit","date-submit-button","button green","search");n.appendChild(o),e.appendChild(n),e.addEventListener("submit",async r=>{r.preventDefault();const p=new FormData(e),l=p.get("start-date-input"),d=p.get("end-date-input");if(l&&d){e.remove();const g=await k(l.toString(),d.toString());g.length>0&&(w(g),v(g)),u(`${g.length} inspections between ${l} and ${d}`,"main-message","info")}else u("Please enter a start and end date","main-message","error")}),m.appendChild(e)}catch(e){u(e,"main-message","error")}}async function Q(){try{const e=c("form","set-temp-range-form",null,null),s=c("h3",null,null,"Search temperature between");e.appendChild(s);const n=c("section",null,"search-button-group",null),t=C("number","min-temp-input",null,null);n.appendChild(t);const i=c("p",null,null,"and");n.appendChild(i);const a=C("number","max-temp-input",null,null);n.appendChild(a);const o=h("Search","submit","temp-submit-button","button green","search");n.appendChild(o),e.appendChild(n),e.addEventListener("submit",async r=>{r.preventDefault();const p=new FormData(e),l=p.get("min-temp-input"),d=p.get("max-temp-input");if(l&&d){e.remove();const g=await A(parseInt(l.toString()),parseInt(d.toString()));g.length>0&&(w(g),v(g)),u(`${g.length} inspections between ${l}°F and ${d}°F`,"main-message","info")}else u("Please enter a min and max temperature","main-message","error")}),m.appendChild(e)}catch(e){u(e,"main-message","error")}}async function P(){try{const e=c("section","condition-selection","form-row",null),s=c("h2",null,null,"Weather Condition:"),n=T.reduce((i,a)=>{const o=document.createElement("option");return o.textContent=a,o.setAttribute("value",a),i.appendChild(o),i},document.createElement("select"));n.addEventListener("change",async i=>{const o=i.target.value;e.remove();const r=await $(o);r.length>0&&(w(r),v(r)),u(`${r.length} inspections with weather condition ${o}`,"main-message","info")});const t=document.createElement("option");t.textContent="Select a condition",t.selected=!0,n.prepend(t),e.appendChild(s),e.appendChild(n),m.appendChild(e)}catch(e){u(e,"main-message","error")}}async function G(){const e=c("section","queen-button-row","button-group-row",null),s=h("Queen was spotted","button","queen-spotted-button","button green full");s.addEventListener("click",async()=>{e.remove();const t=await _(1);t.length>0&&(w(t),v(t)),u(`${t.length} inspections where the queen was spotted`,"main-message","info")}),e.appendChild(s);const n=h("Queen wasn't spotted","button","queen-spotted-button","button red full");n.addEventListener("click",async()=>{e.remove();const t=await _(0);t.length>0&&(w(t),v(t)),u(`${t.length} inspections where the queen wasn't spotted`,"main-message","info")}),e.appendChild(n),m.appendChild(e)}
